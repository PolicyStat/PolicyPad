<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>WYMeditor</title>
<!-- jQuery library is required, see http://jquery.com/ -->
<script type="text/javascript" src="wymeditor/jquery/jquery.js"></script>
<!-- WYMeditor main JS file, minified version -->
<script type="text/javascript" src="wymeditor/wymeditor/jquery.wymeditor.js"></script>

<script type="text/javascript" src="http://kevinwells.homeip.net:8082/comet/js/client.js"></script>
<script type="text/javascript" src="http://kevinwells.homeip.net:8082/static/js/collab_client.js"></script>
<script type="text/javascript" src="http://kevinwells.homeip.net:8082/static/js/pad_utils.js"></script>
<script type="text/javascript" src="../policypad.js"></script>
<script type="text/javascript" src="../etherpaddocument.js"></script>
<script type="text/javascript" src="../wymetherpad.js"></script>
<script type="text/javascript" src="../wymetherpadgui.js"></script>
<script type="text/javascript" src="../etherpadplugin.js"></script>

<script type="text/javascript">

/* Here we replace each element with class 'wymeditor'
 * (typically textareas) by a WYMeditor instance.
 * 
 * We could use the 'html' option, to initialize the editor's content.
 * If this option isn't set, the content is retrieved from
 * the element being replaced.
 */

function getQueryParams(qs) {
    qs = qs.split("+").join(" ");
    var params = {};
    var tokens;

    while (tokens = /[?&]?([^=]+)=([^&]*)/g.exec(qs)) {
        params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
    }
    return params;
}
var $_GET = getQueryParams(document.location.search);

/* DESIGN DECISION

   Do we want to query the initial html from within the plugin, or do we want to do
   that from outside.  An implication is that we need clientVars too, and that typically
   comes along with the initial html that we scrape

*/

jQuery(function() {
  jQuery('.wymeditor').wymeditor({
    html: '', //This can override
    postInit: function(wym) {
      //activate wymplugin
      wym.etherpad({
        //GUI options
      },{
        //Options
        padId: $_GET["padId"],
        initialText: $_GET["initialText"],
        funcLog: debug_log,
        host: window.location.host,
      });
    }
  });
});

function debug_log(msg)
{
    var debug = $('#debug');
    $('<div></div>').text(msg).prependTo(debug);
    $("<br/>").prependTo(debug);
}

function initialize()
{
}

function btnRefresh_onclick() {
    var wym = jQuery.wymeditors(0);
    wym._etherpadGui.submitChanges();
    
}



</script>


</head>

<body onload="initialize();">
<h1>WYMeditor/Etherpad Working Demo</h1>
<form method="post" action="">
<textarea class="wymeditor">Loading...</textarea>
<!--input type="submit" class="wymupdate" /-->
<input type="button" name="btnRefresh" value="Refresh" onclick="btnRefresh_onclick()" />
</form>
    
Debug Output: <div id="debug"></div>

</body>
</html>
